<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AuthSense Desktop - Behavioral Authentication</title>
    <style>
        :root {
            --primary-bg: #e1f5fe;
            --secondary-bg: #fffde7;
            --text-color: #003366;
            --button-bg: #fdd835;
            --nav-bg: #0288d1;
            --card-bg: #ffffff;
            --danger: #f44336;
            --warning: #ff9800;
            --success: #4caf50;
        }

        body {
            margin: 0;
            font-family: 'Segoe UI', sans-serif;
            background: linear-gradient(135deg, var(--primary-bg) 0%, var(--secondary-bg) 100%);
            color: var(--text-color);
            min-height: 100vh;
        }

        .header {
            background: var(--nav-bg);
            color: white;
            padding: 15px 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .auth-status {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .status-indicator {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            animation: pulse 2s infinite;
        }

        .status-secure { background: var(--success); }
        .status-warning { background: var(--warning); }
        .status-danger { background: var(--danger); }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .main-container {
            display: grid;
            grid-template-columns: 300px 1fr 300px;
            gap: 20px;
            padding: 20px;
            max-width: 1400px;
            margin: 0 auto;
        }

        .panel {
            background: var(--card-bg);
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            height: fit-content;
        }

        .behavioral-panel h3 {
            color: var(--nav-bg);
            border-bottom: 2px solid var(--button-bg);
            padding-bottom: 10px;
            margin-bottom: 15px;
        }

        .metric {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
            border-bottom: 1px solid #eee;
        }

        .metric:last-child {
            border-bottom: none;
        }

        .metric-value {
            font-weight: bold;
            padding: 3px 8px;
            border-radius: 4px;
            font-size: 0.9em;
        }

        .normal { background: #e8f5e8; color: #2e7d32; }
        .suspicious { background: #fff3e0; color: #f57c00; }
        .anomaly { background: #ffebee; color: #c62828; }

        .main-content {
            background: var(--card-bg);
            border-radius: 10px;
            padding: 30px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        .banking-interface {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .service-card {
            background: linear-gradient(145deg, #f8f9fa, #e9ecef);
            padding: 20px;
            border-radius: 10px;
            border: 1px solid #dee2e6;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
        }

        .service-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
            background: linear-gradient(145deg, #ffffff, #f1f3f4);
        }

        .service-card h4 {
            color: var(--nav-bg);
            margin-bottom: 10px;
        }

        .honeypot-alert {
            background: linear-gradient(45deg, #ff5722, #ff9800);
            color: white;
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
            text-align: center;
            font-weight: bold;
            display: none;
            animation: shake 0.5s ease-in-out infinite alternate;
        }

        @keyframes shake {
            0% { transform: translateX(-2px); }
            100% { transform: translateX(2px); }
        }

        .ml-insights {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 10px;
            padding: 20px;
            margin-top: 20px;
        }

        .progress-bar {
            background: rgba(255,255,255,0.3);
            border-radius: 10px;
            height: 8px;
            margin: 10px 0;
            overflow: hidden;
        }

        .progress-fill {
            background: var(--button-bg);
            height: 100%;
            border-radius: 10px;
            transition: width 0.3s ease;
        }

        .accessibility-controls {
            background: #f8f9fa;
            border: 2px dashed #6c757d;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
        }

        .accessibility-controls h4 {
            margin-top: 0;
            color: #495057;
        }

        .control-group {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin: 10px 0;
        }

        .btn {
            background: var(--button-bg);
            color: var(--text-color);
            border: none;
            padding: 8px 15px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.9em;
            transition: all 0.2s ease;
        }

        .btn:hover {
            transform: scale(1.05);
            box-shadow: 0 3px 8px rgba(0,0,0,0.2);
        }

        .btn-small {
            font-size: 0.8em;
            padding: 5px 10px;
        }

        .test-area {
            background: #f8f9fa;
            border: 2px solid #dee2e6;
            border-radius: 8px;
            padding: 20px;
            margin: 15px 0;
            min-height: 100px;
            cursor: text;
        }

        .test-area:focus {
            outline: 2px solid var(--nav-bg);
            border-color: var(--nav-bg);
        }

        .log-display {
            background: #1e1e1e;
            color: #00ff00;
            padding: 15px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 0.8em;
            max-height: 200px;
            overflow-y: auto;
            white-space: pre-wrap;
        }

        .threat-level {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px;
            border-radius: 8px;
            margin: 10px 0;
        }

        .threat-low { background: #e8f5e8; border-left: 4px solid #4caf50; }
        .threat-medium { background: #fff3e0; border-left: 4px solid #ff9800; }
        .threat-high { background: #ffebee; border-left: 4px solid #f44336; }

        @media (max-width: 1200px) {
            .main-container {
                grid-template-columns: 1fr;
                gap: 15px;
            }
        }

        .contextual-help {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: var(--nav-bg);
            color: white;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
            transition: all 0.3s ease;
        }

        .contextual-help:hover {
            transform: scale(1.1);
            background: var(--button-bg);
            color: var(--text-color);
        }
    </style>
</head>
<body>
    <div class="header">
        <h2>üè¶ AuthSense Desktop Banking</h2>
        <div class="auth-status">
            <div class="status-indicator status-secure" id="authStatus"></div>
            <span id="authText">Secure Session</span>
            <span id="riskScore">Risk: 0%</span>
        </div>
    </div>

    <div class="main-container">
        <!-- Left Panel - Behavioral Metrics -->
        <div class="panel behavioral-panel">
            <h3>üß† Behavioral Analytics</h3>
            
            <div class="metric">
                <span>Keystroke Rhythm</span>
                <span class="metric-value normal" id="keystroke">Normal</span>
            </div>
            
            <div class="metric">
                <span>Mouse Patterns</span>
                <span class="metric-value normal" id="mouse">Normal</span>
            </div>
            
            <div class="metric">
                <span>Typing Speed</span>
                <span class="metric-value normal" id="typingSpeed">85 WPM</span>
            </div>
            
            <div class="metric">
                <span>Click Pressure</span>
                <span class="metric-value normal" id="clickPressure">Normal</span>
            </div>
            
            <div class="metric">
                <span>Scroll Behavior</span>
                <span class="metric-value normal" id="scrollBehavior">Consistent</span>
            </div>
            
            <div class="metric">
                <span>Navigation Pattern</span>
                <span class="metric-value normal" id="navPattern">Expected</span>
            </div>

            <div class="metric">
                <span>Session Duration</span>
                <span class="metric-value normal" id="sessionTime">12:34</span>
            </div>

            <div class="ml-insights">
                <h4>ü§ñ AI Confidence</h4>
                <div>User Identity: <span id="aiConfidence">94.2%</span></div>
                <div class="progress-bar">
                    <div class="progress-fill" style="width: 94.2%"></div>
                </div>
                <small>LSTM + Autoencoder Model</small>
            </div>

            <div class="threat-level threat-low" id="threatLevel">
                <span>üõ°Ô∏è</span>
                <div>
                    <strong>Threat Level: LOW</strong>
                    <div><small>All systems normal</small></div>
                </div>
            </div>
        </div>

        <!-- Main Content Area -->
        <div class="main-content">
            <h2>Welcome to Secure Banking</h2>
            
            <!-- Accessibility Controls -->
            <div class="accessibility-controls">
                <h4>‚ôø Accessibility & Testing Controls</h4>
                <div class="control-group">
                    <button class="btn btn-small" onclick="toggleHighContrast()">High Contrast</button>
                    <button class="btn btn-small" onclick="increaseFontSize()">Font Size +</button>
                    <button class="btn btn-small" onclick="decreaseFontSize()">Font Size -</button>
                    <button class="btn btn-small" onclick="enableScreenReader()">Screen Reader</button>
                </div>
                <div class="control-group">
                    <button class="btn btn-small" onclick="simulateElderlyUser()">Simulate Elderly User</button>
                    <button class="btn btn-small" onclick="simulateDisabilityMode()">Disability Mode</button>
                    <button class="btn btn-small" onclick="testDuressGesture()">Test Duress Alert</button>
                </div>
            </div>

            <div class="honeypot-alert" id="honeypotAlert">
                üö® SECURITY ALERT: Unusual activity detected. Activating protective measures...
            </div>

            <!-- Interactive Test Area -->
            <div>
                <h3>üîç Behavioral Analysis Test Area</h3>
                <p>Type, click, and interact below to see real-time behavioral analysis:</p>
                <div class="test-area" contenteditable="true" id="testArea" 
                     placeholder="Start typing to analyze your keystroke patterns...">
                    Type something here to test keystroke dynamics and behavioral patterns...
                </div>
            </div>

            <!-- Banking Services -->
            <div class="banking-interface">
                <div class="service-card" onclick="accessAccount()">
                    <h4>üí∞ Account Balance</h4>
                    <p>‚Çπ2,45,680.50</p>
                    <small>Savings Account</small>
                </div>

                <div class="service-card" onclick="transferFunds()">
                    <h4>üí∏ Transfer Funds</h4>
                    <p>Quick & Secure</p>
                    <small>To any account</small>
                </div>

                <div class="service-card" onclick="viewStatements()">
                    <h4>üìä Statements</h4>
                    <p>Download</p>
                    <small>Last 6 months</small>
                </div>

                <div class="service-card" onclick="payBills()">
                    <h4>üí° Pay Bills</h4>
                    <p>Utilities & More</p>
                    <small>One-click payments</small>
                </div>

                <div class="service-card" onclick="investments()">
                    <h4>üìà Investments</h4>
                    <p>Portfolio View</p>
                    <small>Mutual funds & FDs</small>
                </div>

                <div class="service-card" onclick="loans()">
                    <h4>üè† Loans</h4>
                    <p>Apply Online</p>
                    <small>Pre-approved offers</small>
                </div>
            </div>
        </div>

        <!-- Right Panel - System Logs -->
        <div class="panel">
            <h3>üìã Security Logs</h3>
            <div class="log-display" id="securityLogs">
[12:34:56] Session initiated
[12:34:57] Behavioral baseline established
[12:35:02] Keystroke pattern: NORMAL
[12:35:05] Mouse movement: CONSISTENT
[12:35:08] AI confidence: 94.2%
[12:35:12] All systems secure
            </div>

            <h3 style="margin-top: 20px;">‚öôÔ∏è Model Settings</h3>
            <div class="control-group">
                <button class="btn btn-small" onclick="adjustSensitivity('low')">Low Sensitivity</button>
                <button class="btn btn-small" onclick="adjustSensitivity('medium')">Medium</button>
                <button class="btn btn-small" onclick="adjustSensitivity('high')">High Sensitivity</button>
            </div>

            <div style="margin-top: 15px;">
                <label>Anomaly Threshold:</label>
                <input type="range" min="0.1" max="0.9" step="0.1" value="0.3" id="thresholdSlider" 
                       onchange="updateThreshold(this.value)" style="width: 100%; margin: 5px 0;">
                <small>Current: <span id="thresholdValue">0.3</span></small>
            </div>

            <h3 style="margin-top: 20px;">üéØ Honeypot Controls</h3>
            <button class="btn" onclick="activateHoneypot()" style="background: #ff5722; color: white; width: 100%;">
                Activate Honeypot Mode
            </button>
        </div>
    </div>

    <div class="contextual-help" onclick="showHelp()">?</div>

    <script>
        // Behavioral Authentication System
        class DesktopAuthSense {
            constructor() {
                this.sessionData = {
                    startTime: Date.now(),
                    keystrokePatterns: [],
                    mouseMovements: [],
                    clickPatterns: [],
                    scrollBehavior: [],
                    typingSpeed: [],
                    sessionEvents: []
                };
                
                this.userProfile = {
                    avgTypingSpeed: 85,
                    avgKeyInterval: 150,
                    mouseAcceleration: 0.8,
                    clickPressure: 'normal',
                    preferredPaths: []
                };
                
                this.mlModel = {
                    confidence: 94.2,
                    anomalyThreshold: 0.3,
                    riskScore: 0,
                    isHoneypotActive: false
                };

                this.accessibilityMode = {
                    highContrast: false,
                    largerFont: false,
                    elderlyMode: false,
                    disabilityMode: false
                };

                this.init();
            }

            init() {
                this.setupEventListeners();
                this.startSessionTimer();
                this.beginBehavioralAnalysis();
            }

            setupEventListeners() {
                // Keystroke Analysis
                document.addEventListener('keydown', (e) => this.analyzeKeystroke(e));
                document.addEventListener('keyup', (e) => this.analyzeKeyRelease(e));
                
                // Mouse Behavior
                document.addEventListener('mousemove', (e) => this.analyzeMouseMovement(e));
                document.addEventListener('click', (e) => this.analyzeClick(e));
                document.addEventListener('wheel', (e) => this.analyzeScroll(e));
                
                // Focus and Navigation
                document.addEventListener('focusin', (e) => this.analyzeNavigation(e));
                window.addEventListener('beforeunload', () => this.finalizeSession());
                
                // Accessibility shortcuts
                document.addEventListener('keydown', (e) => {
                    if (e.ctrlKey && e.altKey && e.key === 'h') this.enableAccessibilityMode();
                    if (e.ctrlKey && e.shiftKey && e.key === 'D') this.triggerDuressAlert();
                });
            }

            analyzeKeystroke(event) {
                const timestamp = performance.now();
                const keyData = {
                    key: event.key,
                    timestamp: timestamp,
                    ctrlKey: event.ctrlKey,
                    shiftKey: event.shiftKey,
                    altKey: event.altKey
                };

                this.sessionData.keystrokePatterns.push(keyData);
                
                // Calculate typing metrics
                if (this.sessionData.keystrokePatterns.length > 1) {
                    const interval = timestamp - this.sessionData.keystrokePatterns[this.sessionData.keystrokePatterns.length - 2].timestamp;
                    this.sessionData.typingSpeed.push(interval);
                    
                    // Real-time analysis
                    this.performRealTimeAnalysis();
                }

                this.logEvent(`Keystroke: ${event.key} | Interval: ${this.getLastTypingInterval()}ms`);
            }

            analyzeKeyRelease(event) {
                // Analyze dwell time (key press duration)
                const dwellTime = performance.now() - (this.lastKeyDown || performance.now());
                this.sessionData.keystrokePatterns[this.sessionData.keystrokePatterns.length - 1].dwellTime = dwellTime;
            }

            analyzeMouseMovement(event) {
                const timestamp = performance.now();
                const mouseData = {
                    x: event.clientX,
                    y: event.clientY,
                    timestamp: timestamp,
                    movementX: event.movementX,
                    movementY: event.movementY
                };

                this.sessionData.mouseMovements.push(mouseData);
                
                // Calculate velocity and acceleration
                if (this.sessionData.mouseMovements.length > 2) {
                    const velocity = this.calculateMouseVelocity();
                    const acceleration = this.calculateMouseAcceleration();
                    
                    if (Math.abs(acceleration) > 2.0) {
                        this.flagSuspiciousActivity('unusual_mouse_acceleration', acceleration);
                    }
                }
            }

            analyzeClick(event) {
                const clickData = {
                    x: event.clientX,
                    y: event.clientY,
                    button: event.button,
                    timestamp: performance.now(),
                    pressure: event.pressure || 0.5, // For devices that support pressure
                    target: event.target.tagName
                };

                this.sessionData.clickPatterns.push(clickData);
                
                // Analyze click patterns
                if (this.sessionData.clickPatterns.length > 5) {
                    const pattern = this.analyzeClickPattern();
                    if (pattern.isAnomalous) {
                        this.flagSuspiciousActivity('unusual_click_pattern', pattern);
                    }
                }

                this.logEvent(`Click detected: ${event.target.tagName} at (${event.clientX}, ${event.clientY})`);
            }

            analyzeScroll(event) {
                const scrollData = {
                    deltaX: event.deltaX,
                    deltaY: event.deltaY,
                    timestamp: performance.now()
                };

                this.sessionData.scrollBehavior.push(scrollData);
                this.updateUI('scrollBehavior', this.getScrollPattern());
            }

            performRealTimeAnalysis() {
                // LSTM-like pattern analysis
                const recentKeystrokes = this.sessionData.keystrokePatterns.slice(-20);
                const typingRhythm = this.analyzeTypingRhythm(recentKeystrokes);
                
                this.updateUI('keystroke', typingRhythm.status);
                this.updateUI('typingSpeed', `${typingRhythm.wpm} WPM`);

                // Prepare behavior vector to send to real ML backend
                const behaviorVector = {
                    avgKeystrokeInterval: this.getAverageKeystrokeInterval(),
                    mouseVelocity: this.getAverageMouseVelocity(),
                    clickFrequency: this.getClickFrequency(),
                    scrollPattern: this.getScrollPattern(),
                    navigationFlow: this.getNavigationFlow(),
                    sessionDuration: (Date.now() - this.sessionData.startTime) / 1000
                };

                fetch('http://localhost:5000/analyze', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(behaviorVector)
                })
                .then(res => res.json())
                .then(data => {
                    this.mlModel.confidence = data.confidence;
                    this.mlModel.riskScore = data.risk_score;
                    this.updateRiskLevel();

                    if (data.hijack_detected && !this.mlModel.isHoneypotActive) {
                        this.activateHoneypot();
                    }
                });
            }


            analyzeTypingRhythm(keystrokes) {
                if (keystrokes.length < 5) return { status: 'learning', wpm: 85 };
                
                const intervals = [];
                for (let i = 1; i < keystrokes.length; i++) {
                    intervals.push(keystrokes[i].timestamp - keystrokes[i-1].timestamp);
                }
                
                const avgInterval = intervals.reduce((a, b) => a + b, 0) / intervals.length;
                const deviation = this.calculateStandardDeviation(intervals);
                const wpm = Math.round(60000 / (avgInterval * 5)); // Approximate WPM
                
                let status = 'normal';
                if (Math.abs(avgInterval - this.userProfile.avgKeyInterval) > 50) {
                    status = 'suspicious';
                }
                if (deviation > 100) {
                    status = 'anomaly';
                }
                
                return { status, wpm, avgInterval, deviation };
            }

            calculateAnomalyScore() {
                let score = 0;
                
                // Typing pattern analysis
                if (this.sessionData.typingSpeed.length > 10) {
                    const recentSpeed = this.sessionData.typingSpeed.slice(-10);
                    const avgSpeed = recentSpeed.reduce((a, b) => a + b, 0) / recentSpeed.length;
                    const deviation = Math.abs(avgSpeed - this.userProfile.avgKeyInterval);
                    score += Math.min(0.3, deviation / 200);
                }
                
                // Mouse movement analysis
                if (this.sessionData.mouseMovements.length > 20) {
                    const recentMouse = this.sessionData.mouseMovements.slice(-20);
                    const jerkiness = this.calculateMouseJerkiness(recentMouse);
                    score += Math.min(0.3, jerkiness / 10);
                }
                
                // Navigation pattern analysis
                const navAnomalyScore = this.analyzeNavigationPattern();
                score += navAnomalyScore * 0.4;
                
                return Math.min(1.0, score);
            }

            calculateMouseVelocity() {
                if (this.sessionData.mouseMovements.length < 2) return 0;
                
                const current = this.sessionData.mouseMovements[this.sessionData.mouseMovements.length - 1];
                const previous = this.sessionData.mouseMovements[this.sessionData.mouseMovements.length - 2];
                
                const distance = Math.sqrt(
                    Math.pow(current.x - previous.x, 2) + 
                    Math.pow(current.y - previous.y, 2)
                );
                const timeInterval = current.timestamp - previous.timestamp;
                
                return distance / timeInterval;
            }

            calculateMouseAcceleration() {
                if (this.sessionData.mouseMovements.length < 3) return 0;
                
                const velocities = [];
                for (let i = this.sessionData.mouseMovements.length - 3; i < this.sessionData.mouseMovements.length - 1; i++) {
                    const current = this.sessionData.mouseMovements[i + 1];
                    const previous = this.sessionData.mouseMovements[i];
                    const distance = Math.sqrt(
                        Math.pow(current.x - previous.x, 2) + 
                        Math.pow(current.y - previous.y, 2)
                    );
                    const timeInterval = current.timestamp - previous.timestamp;
                    velocities.push(distance / timeInterval);
                }
                
                return (velocities[1] - velocities[0]) / 16.67; // Assuming ~60fps
            }

            analyzeClickPattern() {
                const recentClicks = this.sessionData.clickPatterns.slice(-5);
                let anomalyScore = 0;
                
                // Check for rapid clicking
                for (let i = 1; i < recentClicks.length; i++) {
                    const interval = recentClicks[i].timestamp - recentClicks[i-1].timestamp;
                    if (interval < 100) anomalyScore += 0.2; // Too fast
                    if (interval > 5000) anomalyScore += 0.1; // Too slow
                }
                
                // Check for click location patterns
                const distances = [];
                for (let i = 1; i < recentClicks.length; i++) {
                    const distance = Math.sqrt(
                        Math.pow(recentClicks[i].x - recentClicks[i-1].x, 2) +
                        Math.pow(recentClicks[i].y - recentClicks[i-1].y, 2)
                    );
                    distances.push(distance);
                }
                
                const avgDistance = distances.reduce((a, b) => a + b, 0) / distances.length;
                if (avgDistance > 500) anomalyScore += 0.3; // Erratic clicking
                
                return {
                    isAnomalous: anomalyScore > 0.3,
                    score: anomalyScore,
                    pattern: 'click_analysis'
                };
            }

            flagSuspiciousActivity(type, data) {
                const alert = {
                    type: type,
                    timestamp: Date.now(),
                    data: data,
                    severity: this.calculateSeverity(type, data)
                };
                
                this.sessionData.sessionEvents.push(alert);
                this.logEvent(`üö® ALERT: ${type} - Severity: ${alert.severity}`);
                
                if (alert.severity === 'high') {
                    this.updateUI('threatLevel', 'HIGH');
                    this.showHoneypotAlert();
                }
            }

            activateHoneypot() {
                this.mlModel.isHoneypotActive = true;
                document.getElementById('honeypotAlert').style.display = 'block';
                
                // Start feeding decoy data
                this.startHoneypotMode();
                this.logEvent('üçØ HONEYPOT ACTIVATED - Feeding decoy data to potential attacker');
                
                // Simulate normal banking data but log all activities
                setTimeout(() => {
                    this.logEvent('üîç Forensic tracing initiated');
                    this.logEvent('üìä Collecting attacker behavioral patterns');
                }, 2000);
            }

            startHoneypotMode() {
                // Replace real data with synthetic data
                const decoyData = {
                    balance: "‚Çπ9,99,999.99",
                    accountNumber: "****-****-9999",
                    transactions: [
                        "Decoy transaction 1 - ‚Çπ50,000",
                        "Decoy transaction 2 - ‚Çπ25,000",
                        "Decoy transaction 3 - ‚Çπ75,000"
                    ]
                };
                
                // Update interface with decoy data while logging real attacker behavior
                this.feedDecoyData(decoyData);
            }

            feedDecoyData(decoyData) {
                // This method feeds synthetic data to suspected attackers
                // while continuing to monitor and log their behavior
                console.log('üçØ Feeding decoy data:', decoyData);
                
                // Log every action the suspected attacker makes
                this.enhancedLogging = true;
                this.logEvent('üé≠ Decoy interface activated - All actions now logged for forensics');
            }

            // Accessibility Features
            enableAccessibilityMode() {
                this.accessibilityMode.isEnabled = true;
                this.adjustBehavioralThresholds('accessible');
                this.logEvent('‚ôø Accessibility mode enabled - Adjusted behavioral thresholds');
            }

            adjustBehavioralThresholds(mode) {
                switch(mode) {
                    case 'elderly':
                        this.userProfile.avgKeyInterval += 50; // Slower typing expected
                        this.mlModel.anomalyThreshold += 0.1; // More lenient
                        this.logEvent('üë¥ Elderly user mode - Increased tolerance for slower interactions');
                        break;
                    case 'disability':
                        this.userProfile.mouseAcceleration *= 0.5; // Different mouse patterns
                        this.mlModel.anomalyThreshold += 0.15;
                        this.logEvent('‚ôø Disability mode - Adjusted for alternative input methods');
                        break;
                    case 'accessible':
                        // General accessibility adjustments
                        this.mlModel.anomalyThreshold += 0.05;
                        this.logEvent('üîß General accessibility adjustments applied');
                        break;
                }
            }

            // Duress Detection
            triggerDuressAlert() {
                this.logEvent('üö® DURESS ALERT TRIGGERED - Silent alarm sent to authorities');
                
                // Send silent alert while appearing normal to attacker
                this.sendSilentAlert({
                    type: 'duress',
                    location: 'estimated_user_location',
                    timestamp: Date.now(),
                    sessionId: this.getSessionId()
                });
                
                // Continue normal operation to avoid suspicion
                this.logEvent('üé≠ Continuing normal operation to maintain attacker deception');
            }

            sendSilentAlert(alertData) {
                // In real implementation, this would contact emergency services
                console.log('Silent alert sent:', alertData);
                this.logEvent('üì° Emergency services contacted discreetly');
            }

            // ML Model Functions
            updateLSTMModel() {
                // Simulate LSTM model processing
                const sequenceData = this.sessionData.keystrokePatterns.slice(-50);
                const prediction = this.processSequence(sequenceData);
                
                this.mlModel.confidence = prediction.confidence;
                return prediction;
            }

            processSequence(sequence) {
                // Simplified LSTM-like processing
                if (sequence.length < 10) {
                    return { confidence: 85, pattern: 'learning' };
                }
                
                const patterns = this.extractPatterns(sequence);
                const similarity = this.compareToUserProfile(patterns);
                
                return {
                    confidence: similarity * 100,
                    pattern: patterns.type,
                    anomalyScore: 1 - similarity
                };
            }

            extractPatterns(sequence) {
                const intervals = [];
                const dwellTimes = [];
                
                for (let i = 1; i < sequence.length; i++) {
                    intervals.push(sequence[i].timestamp - sequence[i-1].timestamp);
                    if (sequence[i].dwellTime) dwellTimes.push(sequence[i].dwellTime);
                }
                
                return {
                    type: 'keystroke_sequence',
                    avgInterval: intervals.reduce((a, b) => a + b, 0) / intervals.length,
                    intervalVariation: this.calculateStandardDeviation(intervals),
                    avgDwellTime: dwellTimes.length > 0 ? dwellTimes.reduce((a, b) => a + b, 0) / dwellTimes.length : 0
                };
            }

            compareToUserProfile(patterns) {
                const intervalSimilarity = 1 - Math.min(1, Math.abs(patterns.avgInterval - this.userProfile.avgKeyInterval) / this.userProfile.avgKeyInterval);
                const variationSimilarity = patterns.intervalVariation < 100 ? 0.9 : 0.3; // Threshold-based
                
                return (intervalSimilarity + variationSimilarity) / 2;
            }

            // Autoencoder Anomaly Detection
            runAutoencoderAnalysis() {
                const currentBehavior = this.getCurrentBehaviorVector();
                const reconstructed = this.autoencode(currentBehavior);
                const reconstructionError = this.calculateReconstructionError(currentBehavior, reconstructed);
                
                return {
                    anomalyScore: Math.min(1, reconstructionError / 0.5), // Normalize
                    isAnomalous: reconstructionError > this.mlModel.anomalyThreshold
                };
            }

            getCurrentBehaviorVector() {
                // Create behavior vector for autoencoder
                return {
                    avgKeystrokeInterval: this.getAverageKeystrokeInterval(),
                    mouseVelocity: this.getAverageMouseVelocity(),
                    clickFrequency: this.getClickFrequency(),
                    scrollPattern: this.getScrollPattern(),
                    navigationFlow: this.getNavigationFlow(),
                    sessionDuration: (Date.now() - this.sessionData.startTime) / 1000
                };
            }

            autoencode(behaviorVector) {
                // Simplified autoencoder simulation
                // In real implementation, this would use TensorFlow.js
                const encoded = this.encode(behaviorVector);
                const decoded = this.decode(encoded);
                return decoded;
            }

            encode(input) {
                // Simulate encoding to lower dimensional space
                return {
                    feature1: (input.avgKeystrokeInterval + input.mouseVelocity) / 2,
                    feature2: (input.clickFrequency + input.scrollPattern) / 2,
                    feature3: input.sessionDuration * 0.1
                };
            }

            decode(encoded) {
                // Simulate decoding back to original space
                return {
                    avgKeystrokeInterval: encoded.feature1 + (Math.random() - 0.5) * 20,
                    mouseVelocity: encoded.feature1 + (Math.random() - 0.5) * 0.2,
                    clickFrequency: encoded.feature2 + (Math.random() - 0.5) * 0.1,
                    scrollPattern: encoded.feature2 + (Math.random() - 0.5) * 0.1,
                    navigationFlow: 0.8 + (Math.random() - 0.5) * 0.2,
                    sessionDuration: encoded.feature3 * 10
                };
            }

            calculateReconstructionError(original, reconstructed) {
                let error = 0;
                const keys = Object.keys(original);
                
                keys.forEach(key => {
                    const diff = Math.abs(original[key] - reconstructed[key]);
                    error += diff * diff;
                });
                
                return Math.sqrt(error / keys.length);
            }

            // Utility Functions
            calculateStandardDeviation(values) {
                const mean = values.reduce((a, b) => a + b, 0) / values.length;
                const squaredDiffs = values.map(value => Math.pow(value - mean, 2));
                const variance = squaredDiffs.reduce((a, b) => a + b, 0) / values.length;
                return Math.sqrt(variance);
            }

            calculateMouseJerkiness(movements) {
                if (movements.length < 3) return 0;
                
                let jerkiness = 0;
                for (let i = 2; i < movements.length; i++) {
                    const acceleration1 = this.calculateMouseAcceleration();
                    jerkiness += Math.abs(acceleration1);
                }
                
                return jerkiness / (movements.length - 2);
            }

            analyzeNavigationPattern() {
                // Analyze how user navigates through the interface
                const expectedPaths = ['home', 'accounts', 'transfer', 'statements'];
                const actualPath = this.getCurrentNavigationPath();
                
                let similarity = 0;
                expectedPaths.forEach(path => {
                    if (actualPath.includes(path)) similarity += 0.25;
                });
                
                return 1 - similarity; // Return anomaly score (0 = normal, 1 = anomalous)
            }

            getCurrentNavigationPath() {
                // Extract navigation path from session events
                return this.sessionData.sessionEvents
                    .filter(event => event.type === 'navigation')
                    .map(event => event.data.target)
                    .slice(-10); // Last 10 navigation events
            }

            getAverageKeystrokeInterval() {
                if (this.sessionData.typingSpeed.length === 0) return this.userProfile.avgKeyInterval;
                return this.sessionData.typingSpeed.reduce((a, b) => a + b, 0) / this.sessionData.typingSpeed.length;
            }

            getAverageMouseVelocity() {
                if (this.sessionData.mouseMovements.length < 2) return 0;
                
                let totalVelocity = 0;
                for (let i = 1; i < Math.min(this.sessionData.mouseMovements.length, 20); i++) {
                    const current = this.sessionData.mouseMovements[i];
                    const previous = this.sessionData.mouseMovements[i - 1];
                    const distance = Math.sqrt(
                        Math.pow(current.x - previous.x, 2) + 
                        Math.pow(current.y - previous.y, 2)
                    );
                    const timeInterval = current.timestamp - previous.timestamp;
                    totalVelocity += distance / timeInterval;
                }
                
                return totalVelocity / Math.min(this.sessionData.mouseMovements.length - 1, 19);
            }

            getClickFrequency() {
                const sessionDuration = (Date.now() - this.sessionData.startTime) / 1000;
                return this.sessionData.clickPatterns.length / sessionDuration;
            }

            getScrollPattern() {
                if (this.sessionData.scrollBehavior.length === 0) return 0.5;
                
                const avgScrollDelta = this.sessionData.scrollBehavior
                    .map(scroll => Math.abs(scroll.deltaY))
                    .reduce((a, b) => a + b, 0) / this.sessionData.scrollBehavior.length;
                
                return Math.min(1, avgScrollDelta / 100); // Normalize
            }

            getNavigationFlow() {
                // Measure how smoothly user navigates
                const navEvents = this.sessionData.sessionEvents.filter(e => e.type === 'navigation');
                if (navEvents.length < 2) return 0.8; // Default for new sessions
                
                let smoothness = 0;
                for (let i = 1; i < navEvents.length; i++) {
                    const timeGap = navEvents[i].timestamp - navEvents[i-1].timestamp;
                    if (timeGap > 1000 && timeGap < 10000) smoothness += 1; // Normal timing
                }
                
                return smoothness / (navEvents.length - 1);
            }

            getLastTypingInterval() {
                if (this.sessionData.typingSpeed.length === 0) return 0;
                return this.sessionData.typingSpeed[this.sessionData.typingSpeed.length - 1];
            }

            calculateSeverity(type, data) {
                switch(type) {
                    case 'unusual_mouse_acceleration':
                        return Math.abs(data) > 3 ? 'high' : 'medium';
                    case 'unusual_click_pattern':
                        return data.score > 0.6 ? 'high' : data.score > 0.3 ? 'medium' : 'low';
                    case 'typing_anomaly':
                        return data.deviation > 200 ? 'high' : 'medium';
                    default:
                        return 'low';
                }
            }

            // UI Update Functions
            updateUI(elementId, value) {
                const element = document.getElementById(elementId);
                if (!element) return;
                
                if (elementId.includes('metric-value')) {
                    element.className = 'metric-value ' + this.getStatusClass(value);
                }
                element.textContent = value;
            }

            getStatusClass(value) {
                if (typeof value === 'string') {
                    if (value.includes('anomaly') || value.includes('high')) return 'anomaly';
                    if (value.includes('suspicious') || value.includes('medium')) return 'suspicious';
                }
                return 'normal';
            }

            updateRiskLevel() {
                const riskElement = document.getElementById('riskScore');
                const statusElement = document.getElementById('authStatus');
                const textElement = document.getElementById('authText');
                const threatElement = document.getElementById('threatLevel');
                
                if (this.mlModel.riskScore < 20) {
                    statusElement.className = 'status-indicator status-secure';
                    textElement.textContent = 'Secure Session';
                    threatElement.className = 'threat-level threat-low';
                    threatElement.innerHTML = '<span>üõ°Ô∏è</span><div><strong>Threat Level: LOW</strong><div><small>All systems normal</small></div></div>';
                } else if (this.mlModel.riskScore < 60) {
                    statusElement.className = 'status-indicator status-warning';
                    textElement.textContent = 'Monitoring Session';
                    threatElement.className = 'threat-level threat-medium';
                    threatElement.innerHTML = '<span>‚ö†Ô∏è</span><div><strong>Threat Level: MEDIUM</strong><div><small>Increased monitoring active</small></div></div>';
                } else {
                    statusElement.className = 'status-indicator status-danger';
                    textElement.textContent = 'High Risk Session';
                    threatElement.className = 'threat-level threat-high';
                    threatElement.innerHTML = '<span>üö®</span><div><strong>Threat Level: HIGH</strong><div><small>Security measures activated</small></div></div>';
                }
                
                riskElement.textContent = `Risk: ${Math.round(this.mlModel.riskScore)}%`;
                
                // Update AI confidence display
                const confidenceElement = document.getElementById('aiConfidence');
                if (confidenceElement) {
                    confidenceElement.textContent = `${this.mlModel.confidence.toFixed(1)}%`;
                    const progressFill = document.querySelector('.progress-fill');
                    if (progressFill) {
                        progressFill.style.width = `${this.mlModel.confidence}%`;
                    }
                }
            }

            showHoneypotAlert() {
                const alert = document.getElementById('honeypotAlert');
                alert.style.display = 'block';
                
                setTimeout(() => {
                    alert.innerHTML = 'üçØ Digital honeypot active - Collecting forensic data...';
                }, 3000);
            }

            logEvent(message) {
                const timestamp = new Date().toLocaleTimeString();
                const logDisplay = document.getElementById('securityLogs');
                
                const newLog = `[${timestamp}] ${message}\n`;
                logDisplay.textContent += newLog;
                
                // Keep only last 20 lines
                const lines = logDisplay.textContent.split('\n');
                if (lines.length > 20) {
                    logDisplay.textContent = lines.slice(-20).join('\n');
                }
                
                // Auto scroll to bottom
                logDisplay.scrollTop = logDisplay.scrollHeight;
            }

            startSessionTimer() {
                setInterval(() => {
                    const duration = Date.now() - this.sessionData.startTime;
                    const minutes = Math.floor(duration / 60000);
                    const seconds = Math.floor((duration % 60000) / 1000);
                    const timeString = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
                    
                    this.updateUI('sessionTime', timeString);
                }, 1000);
            }

            beginBehavioralAnalysis() {
                setInterval(() => {
                    const behaviorVector = {
                        avgKeystrokeInterval: this.getAverageKeystrokeInterval(),
                        mouseVelocity: this.getAverageMouseVelocity(),
                        clickFrequency: this.getClickFrequency(),
                        scrollPattern: this.getScrollPattern(),
                        navigationFlow: this.getNavigationFlow(),
                        sessionDuration: (Date.now() - this.sessionData.startTime) / 1000
                    };

                    fetch('http://localhost:5000/analyze', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(behaviorVector)
                    })
                    .then(res => res.json())
                    .then(data => {
                        // Replace simulated logic with real ML output
                        this.mlModel.riskScore = data.risk_score;
                        this.mlModel.confidence = data.confidence;
                        this.updateRiskLevel();

                        if (data.hijack_detected && !this.mlModel.isHoneypotActive) {
                            this.activateHoneypot();
                        }

                        // Optional logging
                        this.logEvent(
                            `ML Analysis - Risk: ${Math.round(data.risk_score)}%, Confidence: ${Math.round(data.confidence)}%`
                        );
                    });

                    // You can still do pattern analysis separately if you want
                    this.performRealTimeAnalysis();
                }, 5000);
            }


            getSessionId() {
                return 'session_' + Date.now();
            }

            finalizeSession() {
                this.logEvent('Session ending - Finalizing behavioral profile');
                
                // Save session data for future model training
                const sessionSummary = {
                    duration: Date.now() - this.sessionData.startTime,
                    totalKeystrokes: this.sessionData.keystrokePatterns.length,
                    totalMouseMovements: this.sessionData.mouseMovements.length,
                    totalClicks: this.sessionData.clickPatterns.length,
                    avgTypingSpeed: this.getAverageKeystrokeInterval(),
                    riskScore: this.mlModel.riskScore,
                    anomaliesDetected: this.sessionData.sessionEvents.length,
                    honeypotActivated: this.mlModel.isHoneypotActive
                };
                
                console.log('Session Summary:', sessionSummary);
            }
        }

        // Global Functions for UI Interactions
        let authSense;

        function initializeAuthSense() {
            authSense = new DesktopAuthSense();
        }

        function accessAccount() {
            authSense.sessionData.sessionEvents.push({
                type: 'navigation',
                data: { target: 'account', action: 'view_balance' },
                timestamp: Date.now()
            });
            authSense.logEvent('User accessed account balance');
        }

        function transferFunds() {
            authSense.sessionData.sessionEvents.push({
                type: 'navigation',
                data: { target: 'transfer', action: 'initiate_transfer' },
                timestamp: Date.now()
            });
            authSense.logEvent('User initiated fund transfer - High security action');
            
            // High-risk action - increase monitoring
            authSense.mlModel.riskScore += 5;
            authSense.updateRiskLevel();
        }

        function viewStatements() {
            authSense.sessionData.sessionEvents.push({
                type: 'navigation',
                data: { target: 'statements', action: 'download' },
                timestamp: Date.now()
            });
            authSense.logEvent('User requested account statements');
        }

        function payBills() {
            authSense.sessionData.sessionEvents.push({
                type: 'navigation',
                data: { target: 'bills', action: 'pay_utility' },
                timestamp: Date.now()
            });
            authSense.logEvent('User accessed bill payment');
        }

        function investments() {
            authSense.sessionData.sessionEvents.push({
                type: 'navigation',
                data: { target: 'investments', action: 'view_portfolio' },
                timestamp: Date.now()
            });
            authSense.logEvent('User viewed investment portfolio');
        }

        function loans() {
            authSense.sessionData.sessionEvents.push({
                type: 'navigation',
                data: { target: 'loans', action: 'apply' },
                timestamp: Date.now()
            });
            authSense.logEvent('User accessed loan application');
        }

        // Accessibility Functions
        function toggleHighContrast() {
            document.body.style.filter = document.body.style.filter ? '' : 'contrast(150%) brightness(120%)';
            authSense.accessibilityMode.highContrast = !authSense.accessibilityMode.highContrast;
            authSense.logEvent(`High contrast mode ${authSense.accessibilityMode.highContrast ? 'enabled' : 'disabled'}`);
        }

        function increaseFontSize() {
            const currentSize = parseFloat(getComputedStyle(document.body).fontSize) || 16;
            document.body.style.fontSize = (currentSize + 2) + 'px';
            authSense.logEvent(`Font size increased to ${currentSize + 2}px`);
        }

        function decreaseFontSize() {
            const currentSize = parseFloat(getComputedStyle(document.body).fontSize) || 16;
            if (currentSize > 12) {
                document.body.style.fontSize = (currentSize - 2) + 'px';
                authSense.logEvent(`Font size decreased to ${currentSize - 2}px`);
            }
        }

        function enableScreenReader() {
            // Add ARIA labels and announce current focus
            const elements = document.querySelectorAll('button, .service-card, input');
            elements.forEach(el => {
                if (!el.getAttribute('aria-label')) {
                    el.setAttribute('aria-label', el.textContent || el.placeholder || 'Interactive element');
                }
            });
            authSense.logEvent('Screen reader support enhanced');
        }

        function simulateElderlyUser() {
            authSense.adjustBehavioralThresholds('elderly');
            authSense.accessibilityMode.elderlyMode = true;
            document.body.style.fontSize = '18px';
            authSense.logEvent('Elderly user simulation activated');
        }

        function simulateDisabilityMode() {
            authSense.adjustBehavioralThresholds('disability');
            authSense.accessibilityMode.disabilityMode = true;
            authSense.logEvent('Disability accommodations activated');
        }

        function testDuressGesture() {
            authSense.triggerDuressAlert();
        }

        // System Control Functions
        function adjustSensitivity(level) {
            switch(level) {
                case 'low':
                    authSense.mlModel.anomalyThreshold = 0.5;
                    break;
                case 'medium':
                    authSense.mlModel.anomalyThreshold = 0.3;
                    break;
                case 'high':
                    authSense.mlModel.anomalyThreshold = 0.1;
                    break;
            }
            authSense.logEvent(`Sensitivity adjusted to ${level.toUpperCase()}`);
        }

        function updateThreshold(value) {
            authSense.mlModel.anomalyThreshold = parseFloat(value);
            document.getElementById('thresholdValue').textContent = value;
            authSense.logEvent(`Anomaly threshold set to ${value}`);
        }

        function activateHoneypot() {
            authSense.activateHoneypot();
        }

        function showHelp() {
            alert(`üîí AuthSense Desktop Behavioral Authentication

Key Features:
‚Ä¢ Real-time keystroke analysis
‚Ä¢ Mouse behavior monitoring  
‚Ä¢ Accessibility support
‚Ä¢ Duress detection (Ctrl+Shift+D)
‚Ä¢ Honeypot protection
‚Ä¢ LSTM + Autoencoder ML models

Accessibility:
‚Ä¢ High contrast mode
‚Ä¢ Font size adjustment
‚Ä¢ Screen reader support
‚Ä¢ Elderly/disability modes

The system continuously monitors your behavior patterns to detect anomalies and potential security threats while maintaining your privacy and accessibility needs.`);
        }

        // Initialize the system when page loads
        document.addEventListener('DOMContentLoaded', function() {
            initializeAuthSense();
        });
    </script>
</body>
</html>